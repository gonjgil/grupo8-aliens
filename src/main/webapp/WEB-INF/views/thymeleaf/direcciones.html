<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Direcciones | ArtRoom</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.2.0/css/bootstrap.min.css}"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.2.0/css/bootstrap.min.css}"/>
    <link rel="stylesheet" th:href="@{/css/galeria.css}"/>

</head>
<body class="bg-gray-100 text-gray-800 flex flex-col min-h-screen">
<!-- Header -->
<header class="bg-white p-6 flex justify-between items-center shadow-md">
    <h1 class="text-4xl font-extrabold text-gray-900 tracking-wider">
        <a th:href="@{/galeria}" class="hover:text-blue-600 transition-colors">
            ArtRoom
        </a>
    </h1>

    <div class="flex items-center space-x-4">
        <div th:if="${usuario != null}" class="flex items-center space-x-4">
            <div th:text=" 'Hola, ' + ${usuario.email}"></div>

            <a th:if="${artistaUsuario != null}"
               th:href="@{'/perfilArtista/ver/' + ${artistaUsuario.id}}"
               class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 shadow-lg"
               title="Ver mi perfil de artista">
                <i class="bi bi-palette-fill"></i>
            </a>

            <a th:if="${artistaUsuario == null}"
               th:href="@{/perfilArtista/nuevo}"
               class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 shadow-lg"
               title="Crear nuevo artista">
                <i class="bi bi-person-plus"></i>
            </a>

            <a th:href="@{/carrito}"
               class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-full transition duration-300 shadow-lg relative">
                <i class="fas fa-shopping-cart"></i>
                <span data-carrito-count
                      class="hidden absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold">
                    0
                </span>
            </a>
            <a th:href="@{/logout}"
               class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 shadow-lg">
                <i class="bi bi-box-arrow-right"></i>
            </a>
        </div>
        <div th:unless="${usuario != null}" class="flex items-center space-x-4">
            <a th:href="@{/login}" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 shadow-lg">
                Iniciar Sesión
            </a>
        </div>
    </div>


</header>

<main class="flex flex-col flex-grow w-full px-4 py-8">
    <div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-2xl font-bold mb-6">Mis Direcciones</h2>

        <div th:if="${direcciones != null and !#lists.isEmpty(direcciones)}" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div th:each="direccion : ${direcciones}" class="p-4 border rounded-lg bg-gray-50 relative">
                <p><strong th:text="${direccion.nombreCalle} + ' ' + ${direccion.altura}"></strong></p>
                <p th:text="${direccion.ciudadBarrio} + ', ' + ${direccion.provincia} + ' - CP ' + ${direccion.codigoPostal}"></p>

                <!-- Badge de dirección predeterminada -->
                <p th:if="${direccion.predeterminada}" class="text-green-600 font-bold mt-2">
                    Predeterminada
                </p>

                <!-- Botón para marcar como predeterminada -->
                <form th:if="${!direccion.predeterminada}"
                      th:action="@{'/usuario/direccion/' + ${direccion.id} + '/predeterminada'}"
                      method="post" class="mt-2">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-md">
                        Seleccionar como predeterminada
                    </button>
                </form>

                <div class="mt-3 flex gap-2">
                    <form th:action="@{/usuario/direccion/{id}(id=${direccion.id})}" method="get">
                        <button type="submit" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded-md">
                            Editar
                        </button>
                    </form>

                    <form th:action="@{/usuario/direccion/eliminar/{id}(id=${direccion.id})}" method="post" onsubmit="return confirm('¿Deseas eliminar esta dirección?');">
                        <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-md">
                            Eliminar
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <div th:if="${direcciones == null or #lists.isEmpty(direcciones)}" class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-yellow-800">
            No tienes direcciones registradas.
        </div>

        <div class="mt-6">
            <a th:href="@{/usuario/direccion/}"
               class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md font-bold transition">
                Agregar Nueva Dirección
            </a>
        </div>
    </div>
</main>
<!-- Footer -->
<footer
        class="bg-gray-300 p-6 text-center text-gray-700 mt-12 shadow-inner">
    <p>&copy; 2025 Grupo 8</p>
    <p class="integrantes">Gil - Solodujin - Landín - Santillan - Torrico</p>
</footer>

</body>
<script>
    // Actualizar contador del carrito
    function actualizarContadorCarrito() {
        fetch('/spring/carrito/contador')
            .then(response => response.json())
            .then(data => {
                const contador = document.querySelector('[data-carrito-count]');
                if(contador) {
                    if(data.count > 0) {
                        contador.textContent = data.count;
                        contador.classList.remove('hidden');
                    } else {
                        contador.classList.add('hidden');
                    }
                }
            })
            .catch(error => console.error('Error actualizando contador:', error));
    }
    document.addEventListener('DOMContentLoaded', actualizarContadorCarrito);
</script>

</html>
